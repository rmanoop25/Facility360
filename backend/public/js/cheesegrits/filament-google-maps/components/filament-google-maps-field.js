function ae(s,c){s.src=c}var se=s=>{var c,r,C,d="The Google Maps JavaScript API",f="google",h="importLibrary",P="__ib__",w=document,S=window,L=S[f]||(S[f]={}),_=L.maps||(L.maps={}),E=new Set,y=new URLSearchParams,M=()=>c||(c=new Promise(async(g,m)=>{await(r=w.createElement("script")),y.set("libraries",[...E]+"");for(C in s)y.set(C.replace(/[A-Z]/g,N=>"_"+N[0].toLowerCase()),s[C]);y.set("callback",f+".maps."+P),ae(r,"https://maps.googleapis.com/maps/api/js?"+y),_[P]=g,r.onerror=()=>c=m(Error(d+" could not load.")),r.nonce=w.querySelector("script[nonce]")?.nonce||"",w.head.append(r)}));_[h]?console.warn(d+" only loads once. Ignoring:",s):_[h]=(g,...m)=>E.add(g)&&M().then(()=>_[h](g,...m))};var ie=s=>`The setOptions() function should only be called once. The options passed to the additional call (${JSON.stringify(s)}) will be ignored.`,ne=s=>`The google.maps.importLibrary() function is already defined, and @googlemaps/js-api-loader will use the existing function instead of overwriting it. The options passed to setOptions (${JSON.stringify(s)}) will be ignored.`,re="No options were set before calling importLibrary. Make sure to configure the loader using setOptions().",le="There already is a script loading the Google Maps JavaScript API, and no google.maps.importLibrary function is defined. @googlemaps/js-api-loader will proceed to bootstrap the API with the specified options, but the existing script might cause problems using the API. Make sure to remove the script loading the API.",K=!1,B=K?s=>{console.warn(`[@googlemaps/js-api-loader] ${s}`)}:()=>{},ce=K?s=>{console.info(`[@googlemaps/js-api-loader] ${s}`)}:()=>{};var pe=!1,x=!1;function V(s){if(x){B(ie(s));return}de(s),x=!0}async function D(s){if(x||B(re),!window?.google?.maps?.importLibrary)throw new Error("google.maps.importLibrary is not installed.");return await google.maps.importLibrary(s)}function de(s){let c=!!window.google?.maps?.importLibrary;c?ce(ne(s)):pe&&document.querySelector('script[src*="maps.googleapis.com/maps/api/js"]')&&B(le),c||se(s)}function me({apiKey:s,state:c,setStateUsing:r,getStateUsing:C,autocomplete:d,autocompleteId:f,autocompleteReverse:h,geolocate:P=!1,geolocateOnLoad:w,geolocateLabel:S,draggable:L,clickable:_,defaultLocation:E,statePath:y,controls:M,kmlLayers:g,reverseGeocodeFields:m,defaultZoom:N,types:q,countries:z,placeField:R,debug:W,mapEl:X,pacEl:Y,geoJson:A,geoJsonField:k,geoJsonProperty:b,geoJsonVisible:Z,reverseGeocodeUsing:H,placeUpdatedUsing:F,hasReverseGeocodeUsing:$=!1,hasPlaceUpdatedUsing:I=!1,mapType:Q="roadmap"}){let l=null,O=null,G=null,p=null,U=null,j={"%n":["street_number"],"%z":["postal_code"],"%S":["street_address","route"],"%A1":["administrative_area_level_1"],"%A2":["administrative_area_level_2"],"%A3":["administrative_area_level_3"],"%A4":["administrative_area_level_4"],"%A5":["administrative_area_level_5"],"%a1":["administrative_area_level_1"],"%a2":["administrative_area_level_2"],"%a3":["administrative_area_level_3"],"%a4":["administrative_area_level_4"],"%a5":["administrative_area_level_5"],"%L":["locality","postal_town"],"%D":["sublocality"],"%C":["country"],"%c":["country"],"%p":["premise"],"%P":["premise"],"%sp":["subpremise","route"],"%SP":["subpremise","route"]},T=null,J=null,v=[];return{state:c,init:function(){this.createMap()},async createMap(){V({key:s});let{Map:o}=await D("maps"),{PlacesService:t}=await D("places"),{AdvancedMarkerElement:n}=await D("marker");if((h||Object.keys(m).length>0)&&(G=new google.maps.Geocoder),l=new o(X,{mapId:y,center:this.getCoordinates(),zoom:N,mapTypeId:google.maps.MapTypeId[Q.toUpperCase()],...M}),O=new n({gmpDraggable:L,position:this.getCoordinates(),map:l}),_&&l.addListener("click",e=>{this.markerMoved(e)}),L&&google.maps.event.addListener(O,"dragend",e=>{this.markerMoved(e)}),M.searchBoxControl){let e=Y,a=new google.maps.places.SearchBox(e);l.controls[google.maps.ControlPosition.TOP_LEFT].push(e),a.addListener("places_changed",()=>{e.value="",p=a.getPlaces()[0].geometry.location})}if(I&&(J=new google.maps.places.PlacesService(l)),v=["address_components","formatted_address","geometry","name"],v.includes(R)||v.push(R),I&&v.push("photos"),d&&f){let e=document.getElementById(f);if(e){window.addEventListener("keydown",function(i){if((i.key==="U+000A"||i.key==="Enter"||i.code==="Enter")&&i.target.nodeName==="INPUT"&&i.target.type==="text")return i.preventDefault(),!1},!0);let a={fields:v,strictBounds:!1,types:q},u=new google.maps.places.Autocomplete(e,a);u.setComponentRestrictions({country:z}),u.addListener("place_changed",()=>{let i=u.getPlace();if(!i.geometry||!i.geometry.location){window.alert("No details available for input: '"+i.name+"'");return}i.geometry.viewport?l.fitBounds(i.geometry.viewport):l.setCenter(i.geometry.location),r(d,i[R]),O.position=i.geometry.location,p=i.geometry.location,this.setCoordinates(i.geometry.location),this.updateGeocodeFromAddressComponents(i.address_components),I&&F(i)})}}if(g&&(U=g.map(e=>{new google.maps.KmlLayer({url:e,map:l}).addListener("click",u=>{let i=u.featureData.description})})),A&&(Z?T=l.data:T=new google.maps.Data,/^http/.test(A)?T.loadGeoJson(A):T.addGeoJson(JSON.parse(A))),w&&this.getLocation(),P&&"geolocation"in navigator){let e=document.createElement("button");e.textContent=S,e.classList.add("custom-map-control-button"),l.controls[google.maps.ControlPosition.TOP_CENTER].push(e),e.addEventListener("click",a=>{a.preventDefault(),this.getLocation()})}this.$watch("state",()=>{if(this.state===void 0)return;let e=this.getCoordinates(),a=O.position;e.lat===a.lat&&e.lng===a.lng||(this.updateAutocompleteFromLocation(e),this.updateMap(e))})},markerMoved:function(o){this.geoJsonContains(o.latLng),p=o.latLng.toJSON(),this.setCoordinates(p),this.updateFromLocation(p),l.panTo(p),I&&o.placeId&&J.getDetails({placeId:o.placeId,fields:v},(t,n)=>{n==="OK"&&F(t)})},updateMap:function(o){O.position=o,l.panTo(o)},updateFromLocation:function(o){(this.hasReverseGeocode()||this.hasReverseAutocomplete())&&G.geocode({location:o}).then(t=>{this.updateGeocodeFromAddressComponents(t.results[0].address_components),this.updateAutocompleteFromFormattedAddress(t.results[0].formatted_address),$&&H(t)}).catch(t=>{console.log(t.message)})},updateGeocodeFromAddressComponents:function(o){if(this.hasReverseGeocode()){let t=this.getReplacements(o);for(let n in m){let e=m[n];for(let a in t)e=e.split(a).join(t[a]);for(let a in j)e=e.split(a).join("");e=e.trim(),r(n,e)}}},updateGeocodeFromLocation:function(o){this.hasReverseGeocode()&&G.geocode({location:o}).then(t=>t.results[0].address_components).then(t=>this.updateGeocodeFromAddressComponents(t)).catch(t=>{console.log(t.message)})},updateAutocompleteFromFormattedAddress:function(o){this.hasReverseAutocomplete()&&r(d,o)},updateAutocompleteFromLocation:function(o){this.hasReverseAutocomplete()&&G.geocode({location:o}).then(t=>{t.results[0]&&r(d,t.results[0].formatted_address)}).catch(t=>{console.log(t.message)})},hasReverseAutocomplete:function(){return d&&h},hasReverseGeocode:function(){return Object.keys(m).length>0||$},setCoordinates:function(o){this.state=o},getCoordinates:function(){return(this.state===null||!this.state.hasOwnProperty("lat"))&&(this.state={lat:E.lat,lng:E.lng}),this.state},getLocation:function(){navigator.geolocation.getCurrentPosition(o=>{p={lat:o.coords.latitude,lng:o.coords.longitude},this.setCoordinates(p),this.updateFromLocation(p),l.panTo(p)})},getReplacements:function(o){let t={};return o.forEach(n=>{for(let e in j)j[e].indexOf(n.types[0])!==-1&&(e===e.toLowerCase()?t[e]=n.short_name:t[e]=n.long_name)}),W&&console.log(t),t},geoJsonContains:function(o){if(A&&k){let t=[],n=new google.maps.Data;T.forEach(a=>{if(a.getGeometry().getType()==="Polygon"){var u=new google.maps.Polygon({path:a.getGeometry().getAt(0).getArray()});google.maps.geometry.poly.containsLocation(o,u)&&(b?t.push(a.getProperty(b)):n.add(a))}a.getGeometry().getType()==="MultiPolygon"&&a.getGeometry().getArray().forEach(function(ee,ge){let te=ee.getAt(0).getArray(),oe=new google.maps.Polygon({paths:te});google.maps.geometry.poly.containsLocation(o,oe)&&(b?t.push(a.getProperty(b)):n.add(a))})});let e;b?(e=JSON.stringify(t),r(k,e)):n.toGeoJson(a=>{e=JSON.stringify(a),r(k,e)})}}}}export{me as default};
